
/*
 * Testing out breadboard of the Photon-based robot controller
 *  (c) 2019, Team Practical Projects
 *  Note:  HC05 Tx connected to Photon Rx pin; HC05 Rx connected to Photon Tx pin.
 *  Dual mootor control via TB6612FNG based module.  PWM for motor A connected to Photon pin D0;
 *      PWM for motor B connected to Photon pin D1.
*/

// Definitions
byte LEDpin = D7;   // Photon on board LED indicator
byte PWMA = D0;     // motor A speed control
byte PWMB = D1;     // motor B speed control

// motor speed settings
byte LOW_SPEED = 128;  // low speed is half duty cycle
byte HIGH_SPEED = 250;   // high speed is hear 100% duty cycle

// -----------------------------------------------------------------------------------
// SET UP   SET UP   SET UP   SET UP   SET UP   SET UP   SET UP   SET UP   SET UP
// -----------------------------------------------------------------------------------
void setup() {

  // LED output pin
  pinMode(LEDpin, OUTPUT);
  
  // motor speed pins
  pinMode(PWMA, OUTPUT);
  pinMode(PWMB, OUTPUT);

  // Serial USB port
  Serial.begin(9600);
  Serial.println("Set up complete");
  
  // BT serial I/O on Photon Serial1 (Tx and Rx pins)
  Serial1.begin(9600);
  
  // turn off the motors
  analogWrite(PWMA, 0);
  analogWrite(PWMB, 0);

  // flash the LED to show that setup is complete  
  digitalWrite(LEDpin, HIGH);
  delay(1000);
  digitalWrite(LEDpin, LOW);
}

// -----------------------------------------------------------------------------------
// MAIN LOOP     MAIN LOOP     MAIN LOOP     MAIN LOOP     MAIN LOOP     MAIN LOOP
// -----------------------------------------------------------------------------------
void loop() {

  // If the HC-06 has some data (single char) for us, get it
  if (Serial1.available() > 0) {

    // Get the char
    char data = (char) Serial1.read();

    // Depending on value turn LED ON or OFF (or error message)
    switch (data) {

    case '1':   
      Serial.println("ON");
      digitalWrite(LEDpin, HIGH);
      Serial1.print("LED is ON");
      
      // run motors at high speed
      analogWrite(PWMA, HIGH_SPEED);
      analogWrite(PWMB, HIGH_SPEED);
      break;

    case '0':  
      Serial.println("OFF");
      digitalWrite(LEDpin, LOW);
      Serial1.print("LED is OFF");
      
      // run motors at low speed
      analogWrite(PWMA, LOW_SPEED);
      analogWrite(PWMB, LOW_SPEED);      
      break;

    default:
      Serial.print("NOT RECOGNISED: ");
      Serial.println(data);
      Serial1.print("Error!");
    }
  }
}
